<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demand Base Scraper</title>
    <!-- Bootstrap CSS via CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="container mt-5">
        <h2>Demand Base Data Scraper</h2>
        <form id="scraperForm" class="mt-4">
            <div class="mb-3">
                <label for="urlInput" class="form-label">Enter URL:</label>
                <input type="text" id="urlInput" class="form-control"
                    value="https://web.demandbase.com/sales/company/1026419/people"
                    placeholder="https://web.demandbase.com/sales/company/1026419/people" required>
            </div>
            <div class="mb-3">
                <!-- <label for="limitInput" class="form-label">Limit:</label>
                <input type="number" id="limitInput" class="form-control" value="5" min="1"> -->
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
        <div id="result" class="mt-4"></div>
    </div>
    <table id="dataTable" class="table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Title</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Home</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.getElementById('scraperForm').addEventListener('submit', (event) => {
            event.preventDefault();

            const url = document.getElementById("urlInput").value;
            const limit = document.getElementById("limitInput").value;
            const tableBody = document.querySelector("#dataTable tbody");
            tableBody.innerHTML = '';  // Clear the table for new data

            const eventSource = new EventSource(`http://localhost:5003/demand_base?url=${encodeURIComponent(url)}&limit=${limit}`);
            eventSource.onmessage = (event) => {
    if (event.data === "[DONE]") {
        eventSource.close();
        console.log("Stream closed by server.");
        return;
    }

    try {
        const rowData = JSON.parse(event.data);
        console.log('Received data:', rowData);

        const newRow = document.createElement("tr");
        newRow.innerHTML = `
            <td>${rowData.name}</td>
            <td>${rowData.title}</td>
            <td>${rowData.email}</td>
            <td>${rowData.phone}</td>
            <td>${rowData.home}</td>`;
        tableBody.appendChild(newRow);
    } catch (error) {
        console.error("Error parsing received data:", error);
    }
};

eventSource.onerror = (error) => {
    console.error("SSE Error:", error);
    eventSource.close();
};
        });
    </script>

</body>

</html>